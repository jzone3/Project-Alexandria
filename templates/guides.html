{% extends "base.html" %}
{% block title %}Study Guides{% endblock %}
{% block nav_links %}
	<li><a href="/">Home</a></li>
	<li class="active"><a href="#">Guides</a></li>
	{% if signed_in %}
		<li><a href="/upload">Upload</a></li>
	{% endif %}
	<li><a href="/about">About</a></li>
	<li><a href="/contact">Contact</a></li>
{% endblock %}

{% block page_content %}
	<div class="container">
		<div class="well">
			<center>
				<h1>Study Guides</h1>
			</center>
			<!-- Tabs -->
			<ul class="nav nav-tabs" id="guides_tabs">
				<li class="active">
					<a href="#top" data-toggle="tab">Top</a>
				</li>
				<li><a href="#subject" data-toggle="tab">Subject</a></li>
				<li><a href="#teacher" data-toggle="tab">Teacher</a></li>
				<form method="get" class="form-search" style="float:right;">
					<input type="text" name ="q" class="input-xlarge search-query" placeholder="Search All Materials">
					<button type="submit" class="btn">Search</button>
				</form>
			</ul>
			<!-- End Tabs -->

			<div class="tab-content">

				<!-- Top Tab Content -->
				<div class="tab-pane fade active in" id="top">
					<script>
					function tiphide (){
						$('this').tooltip('hide');
					}					
					</script>
					<h2 style="margin:0;">Top Guides</h2>
					<div align="center">
						<script type="text/javascript"><!--
						google_ad_client = "ca-pub-1213608668776384";
						/* Top Guides */
						google_ad_slot = "5402750935";
						google_ad_width = 728;
						google_ad_height = 90;
						//-->
						</script>
						<script type="text/javascript"
						src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
						</script>
					</div>
					<br />
					<table class="table-hover">
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th>#</th>
								<th>Title</th>
								<th>Subject</th>
								<th>Uploader</th>
								<th>Teacher</th>					
								<th>Votes</th>
							</tr>
						</thead>
						<tbody>
							{% for guide in top_guides %}
								<tr>
									<td>
										<div class="btn-group btn-group btn-group-vertical answer" data-toggle="buttons-radio" id="{{ guide.key() }}">
											<button class="btn btn-mini vote up"><i class="icon-caret-up"></i></button>
											<span rel="tooltip" id="tip_{{ guide.key()}}" class="tooltips" title="You already voted for this guide. <a href='#' class='tiplink' onclick=&quot;$('#tip_{{guide.key()}}').tooltip('hide')&quot;>&times;</a>" data-placement="right" style="float:right;"></span>
											<button class="btn btn-mini vote down"><i class="icon-caret-down"></i></button>											
										</div>
									</td>
									<td>{{ loop.index + page_offset }}</td>
									<td><a href="/guides/{{ guide.url }}">{{ guide.title }}</a></td>
									<td>{{ guide.subject }}</td>
									{% if guide.user_created == '[deleted]' %}
										<td>{{ guide.user_created }}</td>
									{% else %}
										<td><a href="/user/{{ guide.user_created }}">{{ guide.user_created }}</a></td>
									{% endif %}
									<td>{{ guide.teacher }}</td>
									<td id="votes_{{ guide.key() }}"> {{ guide.votes|str_votes }}</td>
								</tr>
							{% endfor %}
							
						</tbody>
					</table>
					<span style="text-align:center">
						{% if page > 0 %} <a href='guides?page={{ page - 1 }}'>Previous</a> {% endif %}
						{% if top_guides|length == 25 %}<a href='guides?page={{ page + 1 }}'>Next</a>{% endif %}
					</span>
				</div>
				<!-- End Top Tab Content -->

				<!-- Subject Tab Content -->
				<div class="tab-pane fade" id="subject">
					<div id="subjectlist">
						<ul class="breadcrumb">
							<li class="active">Subjects <span class="divider">/</span></li>
						</ul>
						<div class="row-fluid">
							{% for subject in subjects %}

							<!-- Start a new row every 3 span4's -->
							{% if loop.index0 is divisibleby(3) %} 
								</div>
								<div class="row-fluid">
							{% endif %}
							<div class="span4 hoverspn4">
								<a href="#{{subject}}" class="subjects" id="{{subject}}">{{ subject }}</a>
								&nbsp;&nbsp;<img src="../static/img/ajax-loader.gif" id="s_{{subject}}load" style="display:none;"/>
							</div>
							{% endfor %}
						</div>
					</div>
					<div id="subjectlist2" style="display:none;"></div>
					<div id="subjectlist3" style="display:none;"></div>
				</div>				
				<!-- End Subject Tab Content -->

				<!-- Teacher Tab Content -->
				<div class="tab-pane fade" id="teacher">
					<div id="teacherlist">
						<ul class="breadcrumb">
							<li class="active">Teachers <span class="divider">/</span></li>
						</ul>
						<div class="row-fluid">
							{% for teacher in teachers %}

							<!-- Start a new row every 3 span4's -->
							{% if loop.index0 is divisibleby(3) %} 
								</div>
								<div class="row-fluid">
							{% endif %}
							<div class="span4 hoverspn4">
								<a href="#{{teacher}}" class="teachers" id="{{teacher}}">{{ teacher }}</a>
								&nbsp;&nbsp;<img src="../static/img/ajax-loader.gif" id="t_{{teacher}}load" style="display:none;"/>
							</div>
							{% endfor %}
						</div>
					</div>
					<div id="teacherlist2" style="display:none;"></div>
					<div id="teacherlist3" style="display:none;"></div>
				</div>
				<!-- End Teacher Tab Content -->

			</div>
		</div>
	</div>

<script>
	// Voting Script
	function str_votes(n) {
		n += '';
		if (n>0){ 
			n = '+' + n;
		}
		return n;
	}

	$('div.answer button.vote').click(function() {
	    var id = $(this).parents('div.answer').attr('id');
	    var vote_type = $(this).hasClass('up') ? 'up' : 'down';
	    var previous_votes = $("td.score_" + id).attr('id');
	    $.ajax({
		    type:'POST', 
		    url:'/vote', 
		    data:'id=' + id + '&type=' + vote_type + '&username=' + "{{ username }}",
		    success: function(response) {
				if (response == 'voted') {
					// if already voted
					$("#tip_" + id).tooltip('show');
				} else if (response == 'signin') {
					$('#login').modal('show');
				} else {
					prev = parseInt($('#votes_' + id).text())
					after = prev + parseInt(response)
					$('#votes_' + id).html(str_votes(after))
					if (vote_type == 'up'){
						$('#votes_' + id).css({'color':'#14BB14'})
					} else {
						$('#votes_' + id).css({'color':'red'})
					}
				}		        
		    }
		});
	});
	// End Voting Script
</script>
<script>
  	// Subjects Tab
	$('.subjects').click(function (e) {
		subject = this.id;
		$(document.getElementById('s_'+subject+'load')).show();
		// used getElementById since there are spaces in ID

	e.preventDefault();
	$.ajax({
	    type:'POST', 
	    url:'/subjects', 
	    data:'subject=' + subject, 
	    success: function(response) {
	    	$(document.getElementById('s_'+subject+'load')).hide();

	    	// used getElementById since there are spaces in ID
	    	$('#subjectlist').hide();
	    	$('#subjectlist2').html(response);
	    	$('#subjectlist2').show();

	    }
	});
	})
	function subtoggle1(){
		$('#subjectlist2').hide();
	$('#subjectlist').show();   
	}
	function subtoggle2(){
		$('#subjectlist3').hide();
	$('#subjectlist').show();   
	}
	function subtoggle3(){
		$('#subjectlist3').hide();
	$('#subjectlist2').show();   
	}
	// End Subjects Tab 
</script>
<script>
	// Teachers Tab
	$('.teachers').click(function (e) {
		teacher = this.id;
		$(document.getElementById('t_'+teacher+'load')).show();
		// used getElementById since there are spaces in ID

	e.preventDefault();
	$.ajax({
	    type:'POST', 
	    url:'/teachers', 
	    data:'teacher=' + teacher, 
	    success: function(response) {
	    	$(document.getElementById('t_'+teacher+'load')).hide();
	    	// used getElementById since there are spaces in ID
	    	$('#teacherlist').hide();
	    	$('#teacherlist2').html(response);
	    	$('#teacherlist2').show();
	        
	    }
	});
	})
	function teachtoggle1(){
		$('#teacherlist2').hide();
	$('#teacherlist').show();   
	}
	function teachtoggle2(){
		$('#teacherlist3').hide();
	$('#teacherlist').show();   
	}
	function teachtoggle3(){
		$('#teacherlist3').hide();
	$('#teacherlist2').show();   
	}
	// End Teachers Tab
</script>

{% endblock %}